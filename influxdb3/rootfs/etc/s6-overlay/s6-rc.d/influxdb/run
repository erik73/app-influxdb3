#!/command/with-contenv bashio
# shellcheck shell=bash
# ==============================================================================
# Home Assistant Add-on: InfluxDB3
# Runs the InfluxDB3 Server
# ==============================================================================
export INFLUXDB3_ENTERPRISE_LICENSE_EMAIL
export INFLUXDB3_ENTERPRISE_LICENSE_TYPE
export INFLUXDB3_ENTERPRISE_CLUSTER_ID
export INFLUXDB3_NODE_IDENTIFIER_PREFIX
export INFLUXDB3_OBJECT_STORE
export INFLUXDB3_DB_DIR
export LOG_FILTER

for envvar in $(bashio::config 'envvars|keys'); do
    name=$(bashio::config "envvars[${envvar}].name")
    value=$(bashio::config "envvars[${envvar}].value")
    bashio::log.debug "Setting Env Variable ${name} to ${value}"
    export "${name}=${value}"
done


influxd_log_level=$(bashio::config 'influxd_log_level')
bashio::log.info "influxd_log_level = ${influxd_log_level}"

bashio::log.info 'Starting InfluxDB v3.x...'

# Run InfluxDB
exec influxdb3 serve